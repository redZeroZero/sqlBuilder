-- Oracle XE seed for sqlBuilder integration (executed as SYS within XEPDB1)
ALTER SESSION SET CONTAINER = XEPDB1;
ALTER SESSION SET CURRENT_SCHEMA = "SB_USER";

BEGIN
	FOR t IN (
		SELECT table_name FROM user_tables
		WHERE UPPER(table_name) IN ('PAYMENTS','ORDER_LINES','ORDERS','CUSTOMERS','PRODUCTS','JOBS','EMPLOYEES','DEPARTMENTS')
	) LOOP
		EXECUTE IMMEDIATE 'DROP TABLE "' || t.table_name || '" CASCADE CONSTRAINTS';
	END LOOP;
END;
/

CREATE TABLE "departments" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"name" VARCHAR2(255) NOT NULL,
	"location" VARCHAR2(255) NOT NULL,
	"budget" NUMBER(12,2) NOT NULL
);

CREATE TABLE "employees" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"first_name" VARCHAR2(255) NOT NULL,
	"last_name" VARCHAR2(255) NOT NULL,
	"email" VARCHAR2(255) NOT NULL UNIQUE,
	"phone" VARCHAR2(64),
	"status" VARCHAR2(64) NOT NULL,
	"department_id" NUMBER REFERENCES "departments"("id"),
	"manager_id" NUMBER REFERENCES "employees"("id"),
	"hire_date" DATE NOT NULL,
	"salary" NUMBER(10,2) NOT NULL,
	"bonus" NUMBER(10,2) DEFAULT 0 NOT NULL
);

CREATE TABLE "jobs" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"title" VARCHAR2(255) NOT NULL,
	"salary" NUMBER(10,2) NOT NULL,
	"employee_id" NUMBER REFERENCES "employees"("id"),
	"start_date" DATE NOT NULL,
	"end_date" DATE,
	"job_type" VARCHAR2(64) NOT NULL
);

CREATE TABLE "products" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"sku" VARCHAR2(128) NOT NULL UNIQUE,
	"name" VARCHAR2(255) NOT NULL,
	"category" VARCHAR2(128) NOT NULL,
	"description" VARCHAR2(1024),
	"inventory_count" NUMBER NOT NULL,
	"price" NUMBER(10,2) NOT NULL
);

CREATE TABLE "customers" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"first_name" VARCHAR2(255) NOT NULL,
	"last_name" VARCHAR2(255) NOT NULL,
	"email" VARCHAR2(255) NOT NULL UNIQUE,
	"phone" VARCHAR2(64),
	"loyalty_level" VARCHAR2(64) DEFAULT 'Bronze' NOT NULL,
	"city" VARCHAR2(255),
	"country" VARCHAR2(255),
	"created_at" TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL
);

CREATE TABLE "orders" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"customer_id" NUMBER REFERENCES "customers"("id"),
	"order_date" TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
	"status" VARCHAR2(64) NOT NULL,
	"shipping_method" VARCHAR2(64) NOT NULL,
	"taxes" NUMBER(12,2) DEFAULT 0 NOT NULL,
	"total" NUMBER(12,2) NOT NULL
);

CREATE TABLE "order_lines" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"order_id" NUMBER REFERENCES "orders"("id"),
	"product_id" NUMBER REFERENCES "products"("id"),
	"quantity" NUMBER NOT NULL,
	"unit_price" NUMBER(10,2) NOT NULL,
	"discount" NUMBER(10,2) DEFAULT 0 NOT NULL,
	"tax_amount" NUMBER(10,2) DEFAULT 0 NOT NULL
);

CREATE TABLE "payments" (
	"id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	"order_id" NUMBER REFERENCES "orders"("id"),
	"amount" NUMBER(12,2) NOT NULL,
	"paid_at" TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
	"method" VARCHAR2(64) NOT NULL,
	"reference" VARCHAR2(255)
);

INSERT INTO "departments" ("name", "location", "budget") VALUES
('Engineering','Montreal',250000),
('Finance','Paris',180000),
('Marketing','Lyon',150000),
('Customer Success','Quebec City',120000);

INSERT INTO "employees" ("first_name", "last_name", "email", "phone", "status", "department_id", "manager_id", "hire_date", "salary", "bonus") VALUES
('Alice','Martin','alice.martin@corp.example','555-1001','ACTIVE',1,NULL,DATE '2015-03-01',95000,15000),
('Bob','Dubois','bob.dubois@corp.example','555-1002','ACTIVE',1,1,DATE '2017-08-15',88000,12000),
('Clara','Leroy','clara.leroy@corp.example','555-2001','ACTIVE',2,2,DATE '2018-01-10',78000,8000),
('David','Marchand','david.marchand@corp.example','555-3001','ACTIVE',3,2,DATE '2019-07-23',67000,5000),
('Eve','Tremblay','eve.tremblay@corp.example','555-1003','ON_LEAVE',1,2,DATE '2020-04-18',72000,4000),
('Felix','Roy','felix.roy@corp.example','555-4001','ACTIVE',4,4,DATE '2021-02-11',62000,3000);

INSERT INTO "jobs" ("title", "salary", "employee_id", "start_date", "end_date", "job_type") VALUES
('Senior Engineer',120000,1,DATE '2019-01-01',NULL,'FULL_TIME'),
('Lead Engineer',110000,2,DATE '2020-06-01',NULL,'FULL_TIME'),
('Financial Analyst',90000,3,DATE '2021-03-15',NULL,'FULL_TIME'),
('Marketing Coordinator',65000,4,DATE '2022-07-01',NULL,'FULL_TIME'),
('Consultant',75000,5,DATE '2023-01-05',DATE '2024-01-05','CONTRACT'),
('Support Specialist',58000,6,DATE '2022-09-10',NULL,'FULL_TIME');

INSERT INTO "products" ("sku", "name", "category", "description", "inventory_count", "price") VALUES
('W-PRO-001','Widget Pro','Hardware','High-end widget for demanding workloads',120,199.99),
('W-LITE-002','Widget Lite','Hardware','Entry-level widget with essential features',250,99.99),
('SRV-PLAN','Service Plan','Services','Extended service coverage for any widget',75,299.00),
('CONSULT-01','Consulting','Services','Professional consulting block priced per day',40,500.00),
('TRAIN-01','Training Workshop','Services','On-site training delivered by experts',20,890.00);

INSERT INTO "customers" ("first_name", "last_name", "email", "phone", "loyalty_level", "city", "country") VALUES
('Emilie','Bernard','emilie.bernard@example.com','555-5001','Gold','Montreal','Canada'),
('Thierry','Rousseau','thierry.rousseau@example.com','555-5002','Silver','Quebec City','Canada'),
('Luc','Germain','luc.germain@example.com','555-5003','Bronze','Paris','France'),
('Sonia','Lapointe','sonia.lapointe@example.com','555-5004','Gold','Toronto','Canada');

INSERT INTO "orders" ("customer_id", "order_date", "status", "shipping_method", "taxes", "total") VALUES
(1, TIMESTAMP '2023-11-02 00:00:00', 'SHIPPED', 'Ground', 59.97, 559.94),
(2, TIMESTAMP '2023-11-12 00:00:00', 'PROCESSING', 'Courier', 29.90, 328.90),
(3, TIMESTAMP '2023-11-20 00:00:00', 'SHIPPED', 'Ground', 69.99, 744.97),
(4, TIMESTAMP '2023-12-01 00:00:00', 'PENDING', 'Express', 89.00, 979.00);

INSERT INTO "order_lines" ("order_id", "product_id", "quantity", "unit_price", "discount", "tax_amount") VALUES
(1, 1, 2, 199.99, 0.00, 49.98),
(1, 2, 1, 99.99, 0.00, 9.99),
(2, 3, 1, 299.00, 0.00, 29.90),
(3, 4, 1, 500.00, 25.00, 50.00),
(3, 2, 2, 99.99, 0.00, 19.99),
(4, 5, 1, 890.00, 0.00, 89.00);

INSERT INTO "payments" ("order_id", "amount", "method", "reference") VALUES
(1, 559.94, 'CARD', 'AUTH-10001'),
(2, 328.90, 'CARD', 'AUTH-10002'),
(3, 744.97, 'WIRE', 'WIRE-20001'),
(4, 489.50, 'CARD', 'AUTH-10003');
